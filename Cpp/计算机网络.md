# 计算机网络

## 计算机网络的基本知识

计算机网络是一个将分散的,具有独立功能的计算机系统,通过**通信设备**与**线路**连接起来,由功能完善的**软件**实现资源共享和信息传递的系统.它是互联的,自治的计算机集合.

计算机网络能够提供 : **数据通信(连通性)**,**资源共享(共享性),包括软件和硬件以及数据的共享**,**分布式处理(多台计算机各自承担同一工作任务的不同部分,典型的就是Hadoop)**,**提高网络可靠性(网络是不可靠的,网络技术的终极目的就是为了解决网络的不可靠性)**,**负载均衡(多台计算机处理任务时不会导致某台负载过高.)**几个重要的功能.

计算机网络的组成 : 

* 硬件部分

  * 计算机
  * 路由器等联通设备
  * 链路

* 软件

* 协议

  它是一系列约定和规则的集合,是计算机网络的核心

计算机网络的工作方式

* 边缘部分 : 计算机所处的位置,用户直接使用的
  * C/S模式 : 客户端/服务器模式
  * P2P模式 : 点对点模式
* 核心部分 : 网络和各种联通设备

计算机网络的功能组成

* 数据通信 
  * 通信子网 : 实现数据通信,OSI七层介质中的最底下的三层就属于通信子网.也就是物理层的集线器,中继器;数据链路层的交换机,网桥;网络层的路由器这些东西组成.
* 资源共享
  * 资源子网 : 实现资源共享/数据处理(数据的打包,传输等),OSI七层的上三层就是属于资源子网的.

计算机网络可按分布范围分为广域网(WAN),城域网(MAN),局域网(WAN),个人区域网(PAN)

按使用者分可以分为公用网(各大运营商的那些),专用网(军方,银行,政府等特殊机构使用的网络)

按交换技术可分为 : 电路交换类型 ; 报文交换类型 ; 分组交换类型

按拓扑结构可分为 : 总线型 ; 星型 ; 环形 ; 网状型 

按传输技术可分为 : 广播式网络(共享公共信道) ; 点对点网络(使用分组存储转发和路由选择机制实现)

### 计算机网络的标准化

标准化是计算机网络中非常重要的一环,硬件,软件之间的互相连通必须要有统一的标准,否则会导致无法联通.

标准的分类:

* 法定分类

  由权威机构指定的正式,合法的标准,比如OSI机构发布的标准

* 事实标准

  某些产品在竞争中占据了主流,时间久了这些产品中的协议和技术就成为了事实上的标准,比如TCP/IP协议就是一个事实上的标准.

计算机网络标准化的一些权威组织 : OSI(国际标准化组织,发布OSI模型,HDLC协议),ITU(国际电信联盟,他们是制定通信规则的),IEEE(国际电气电子工程师协会,是一个学术机构,发布了很多IEEE标准),IETF(Internet工程任务组, 负责因特网标准的制定和审核)

### 计算机网络的相关性能指标

#### 速率指标

* 速率

速率指的是计算机网络中的数据传输率或比特率

比特是计算机网络中传输的最基本的数据,它的表示形式就是1/0

速率说白了就是连接在计算机网络上的主机在数字信道上传送数据位数的速率.从小到大的单位有b/s,kb/s,mb/s,gb/s,tb/s,它们之间是10^3的关系.记得不要跟数据存储的单位弄混了.存储用的是字节作为基本单位,而1字节是有8个比特位的,也就是1Byte = 8Bit.存储单位之间的倍率是2^10(比如1kb = 2^10*1b)

* 带宽

带宽在物理上是指某个信号具有的频带宽度,也就是最高频率和最低频率的差,单位是Hz.

在计算机网络中,带宽表示的是网络的通信线路传送数据的能力,通常指单位时间内从网络中的一点到另一点所能通过的**最高数据率**.单位是比特每秒,跟速率一样.说白了就是网络设备所支持的数据传输的最高速率.

比如说一条链路的带宽是1Mb/s,意思就是说,连着这个链路的主机可在1秒内向链路传入1Mb的数据

* 吞吐量

在计算机网络中,吞吐量指的是单位时间内通过某个网络端口(信道,接口)的数据量,单位跟速率一样.吞吐量会受网络的带宽或网络的额定速率的限制.

#### 其他指标

* 时延

  指数据(报文,分组,比特流)从网络或链路的一端传送到另一端所需要的时间.也叫延迟或者迟延.单位是秒.

  时延由发送(传输)时延(从发送分组的第一个比特开始到该分组的最后一个比特发送完毕所需要的时间,也就是数据从主机全部放到信道上所需的时间),传播时延(数据从信道传送到目标主机上所需的时间.它与信道长度和电磁波在信道上的传播速度[为啥是电磁波?因为我们的信号并不是直接发送出来的,信号在传输到信道上的时候,会经过处理,比如信号的调制,而信号的载体就是电磁波.].),排队时延(等待输入/输出链路可用所需的时间,也就是在路由器里面等待的时间.因为路由器需要检查数据的正确性以及分辨出来这个数据要发送的对象,路由器也不可能同时处理一大堆请求,所以数据需要排队等待处理),处理时延(也就是路由器检查数据正确性以及确认分发目标到分发数据这段时间)四个部分组成.

* 时延带宽积

  是传播时延与带宽的积.它的单位就是比特(因为是秒*比特/秒).它表示的是以比特为单位的链路长度,也就是某段链路现在有多少比特.

* 往返时延(RTT)

  就类似于打LOL的时候右上角的ping.表示从发送发发送数据开始(从数据的第一个比特放到信道上开始,到发送方收到接收方的确认信号中间总共经历的时延.

  RTT包括 : 往返传播时延(传播时延*2) + 末端处理时间(接收方对数据进行处理后才发送确认收到信号)

* 利用率

  有两种

  * 信道利用率

    通信链路在工作时间内有多少时间是有数据通过的.

  * 网络利用率

    就是信道利用率的加权平均值(所有的信道利用率和/信道数量)

  利用率越高,就意味着时延越大(数据越多,越容易导致信道阻塞).

#### 分层结构(计算机网络体系结构)/协议/接口/服务

* 分层

  发送数据的时候,计算机要做的事:

  1.在发送数据前,必须要将数据通信的通路激活

  2.告诉网络如何识别目的主机

  3.发起通信的计算机要知道要发送数据给的目的主机是否在线(开机的并且网络联通)

  4.发起通信的计算机要知道目的计算机的文件管理程序是否做好准备

  5.确保传输过程中的意外可以解决

  6................还有很多很多事.

  如此多的事情,不可能在同一个地方都弄完了,所以需要进行分层.

  分层的基本规则:

  * 各层之间互相独立,每层只实现一种相对独立的功能
  * 每层之间界面自然清晰,易于理解,相互交流尽可能少
  * 结构上可分开,每层都采用最合适的技术实现
  * 保持下层对上层的独立性,上层单向使用下层提供的服务.
  * 整个分层结构应该能促进标准化工作.

  基本的分层结构中的东西:

  * 实体 : 第n层中的活动元素称为n层实体,同一层的实体叫对等实体
  * 协议 : 为进行网络中的对等实体数据交换而建立的规则/标准/约定,称为网络协议.它们是对等实体之间的规定/约定.它包含三大要素
    * 语法 : 规定传输数据的格式
    * 语义 : 规定所要完成的功能
    * 同步 : 规定各种操作的顺序
  * 接口(访问服务点SAP) : 上层使用下层服务的入口
  * 服务 : 下层为相邻上层提供的服务调用
  * SDU : 服务数据单元,为完成用户所要求的功能而传递的数据.
  * PCI : 协议控制信息 ,控制协议操作的信息
  * PDU : SDU + PCI ,协议数据单元 ,是对等层次之间传送的数据单位.上层的数据(SDU)加上PCI就是下层的SDU部分.也就是上层的PDU是下层的SDU.

常见的分层结构有两种 : 

* OSI的7层计算机网络体系结构,这是一个法定标准
* TCP/IP的4层计算机网络体系结构,这是一个事实标准

基于这两种分层结构,我们可以总结出一个5层体系结构

#### OSI计算机网络体系结构(OSI分层结构)参考模型

上面我们知道,为了解决计算机网络的复杂问题,提出了分层的理论.很多的公司都有自己的想法,它们都提出了自己的计算机网络体系结构.比如IBM公司的SNA,美国国防部的TCP/IP.但要使用这些公司/机构的产品才能支持它们的网络体系结构.各种各样的网络体系结构不能统一的话,会导致各方互通颇为困难,所以ISO就提出了开放系统互联(OSI)参考模型用于统一计算机网络体系结构.OSI模型理论的提出是非常成功的,理论上来讲是非常理想的,也正因为理想,所以实现会很困难,并且运行的时候效率不高,而且它不怎么适合市场,而且在它出现前,TCP/IP模型已经占领了市场.因此OSI模型只能作为一个法定标准供大家借鉴使用.但是它是有巨大的学习价值的,通过它可以深度理解计算机网络的体系结构.

OSI参考模型结构:

OSI参考模型解释通信过程:
主机A-------------------------------路由器(中间系统,可能包含很多个)----------------------------主机B.

主机都包含7层,中间系统只包含下三层(连通子网).因为中间系统不涉及数据的处理.

每一个对等层都有自己的协议来规定这个层是干嘛的.

首先两台主机想要通信,它们物理层必须是互联的,不管是通过有线连接或者无线连接或者网络连接.

A想要发送给B一条信息,那么这个信息会从应用层开始往下开始进行层层包装(就是包装一个PCI,如果是数据链路层,就会加一个尾和一个PCI).直到到达物理层,物理层会把这些打包好的数据送到数据链路上,由数据链路传送数据到中间系统,然后在中间系统就经过下三层(从下往上)进行一次拆包,检查数据,检查完事后又经过下三层(从上往下)进行打包,传送到目的主机也就是B,信息经过主机B从下到上进行层层拆包,最终在B上显示出信息.

整个通信过程基本就是一个数据的打包和拆包的过程.

上四层实现的是端到端的通信.而下三层是点到点的通信.

* 应用层 

  * 功能 : 所有能与用户交互并且能产生网络流量(需要连接网络)的程序 
  * 服务 : 文件传输,电子邮件,万维网...
  * 协议 : FTP,SMTP,HTTP(对应上面的服务).....

* 表示层

  * 功能 : 用于处理在两个通信系统中交换信息的表示方式(语法和语义)
    * 数据格式变换,相当于翻译,比如从比特流到图片.jpg格式的转换
    * 数据加密解密,防止数据被人抓包破解
    * 数据压缩和恢复,对于大文件来说是必须的.
  * 表示层其实并不算一个单独的层次,它一般会被划分在应用层和会话层中.如果硬要说的话,它的主要协议就有JPEG和ASCII等

* 会话层

  * 功能 : 向表示层/用户进程提供建立连接并在连接上有序地传输数据,这个过程就是建立一个会话,也叫做建立同步(SYN),是不是想到了Web的会话Session呢?会话之间彼此独立.
    * 建立,管理,终止会话
    * 使用校验点可使会话在通信失效时从校验点/同步点继续恢复通信,实现数据同步.适用于传输文件的时候.
  * 常见协议有ADSP,ASP等

* 传输层

  * 功能 : 负责主机中两个进程的通信,也就是端到端通信.传输单位是报文段或者用户数据段.本层是向下的最后一个负责端到端的传输的层次,再往下的层次就是点到点的了

    * 可靠传输/不可靠传输

      * 可靠传输需要进行连接的确认,数据发送和收到的确认,保证数据传输的可靠性,也就是面向连接
        * 面向连接 : 需要建立连接,一共分为三个阶段 
          * 建立连接,在此阶段,发出一个建立连接的请求,只有连接成功建立才可以进行数据传输
          * 数据传输,也就是连接建立成功后进行的第二阶段
          * 释放连接,当数据传输完毕,必须释放连接.
      * 不可靠传输不需要管那些,直接发送就完事了,也就是非面向连接
        * 非面向连接 : 直接进行数据传输

    * 差错控制

      纠正传输报文的顺序,丢失等问题

    * 流量控制

      控制发送方发送数据的速度,防止接收方丢包

    * 复用分用

      * 复用 : 多个应用层进程可同时使用下面运输层的服务
      * 分用 : 运输车把收到的信息分别交付给上面应用层中相应的进程

  * 两大协议 : TCP,UDP

* 网络层

  * 功能 : 把分组从源端传输到目的端,为分组交换网上的不同主机提供通信服务.网络层传输单位是数据包.

    * 路由选择

      选择最合适的路由路径,以高效的传输数据到目的端

    * 流量控制

      协调发送端和接收端发送数据的速度

    * 差错控制

      发送发和目的端约定一个规则,以此规则来检查分组是否出错,并且看是否能修复.

    * 拥塞控制

      如果所有的节点都来不及接受分组,而要丢弃大量分组的话,网络会处于拥塞状态.因此需要一些手段来缓解这种拥塞状态.

  * 协议 : IP,IPX,ICMP,IGMP,ARP,RARP,OSPF等

* 数据链路层

  * 功能 : 将网络层传下来的数据报组装成数据帧,数据链路层中的传输单位是帧
    * 成帧 : 定义帧的开始和结束
    * 差错控制 : 检查帧错和位错,并根据一定措施处理错误的数据帧
    * 流量控制 : 同网络层的流量控制
    * 访问(接入)控制 : 控制主机对信道的访问(比如在广播网络中)
  * 协议 : SDLC,HDLC,PPP,STP

* 物理层

  * 功能 : 在物理媒体上实现比特流的透明传输,物理层的传输单位是比特.主要就是把数据转换成电信号放到传输链路上去传输

    透明传输是指不管所传数据是什么样的比特组合,都应该能在链路上传送.

    * 定义接口特性 : 确定电缆的连接啊,接口啊这些东西
    * 定义传输模式 : 包括单工,半双工,全双工
    * 定义传输速率 : 我们那些百兆网,千兆网都是这个定义的
    * 比特同步 : 保证比特同步
    * 比特编码 : 哪种电压表示1,哪种电压表示0,数据应该被打包成啥样...

  * 协议 : RJ45,802.3等

#### TCP/IP参考模型与5层参考模型

TCP/IP模型有4层结构:

* 应用层 : 对应OSI的上三层
* 传输层 : 对应OSI的传输层
* 网际层 : 对应OSI的网络层
* 网络接口层 : 对应OSI的下两层

TCP/IP协议栈:为啥叫TCP/IP,因为在这里面TCP协议与IP协议是最重要的两个协议.

* HTTP,FTP,DNS等应用层协议
* TCP,UDP等传输层协议
* IP网际层协议
* Ethernet,ATM,Frame Relay等网络接口层协议

TCP/IP与OSI的区别:

* OSI定义了三点:服务,协议,接口
* OSI先出现,参考模型先于协议发明,不偏向特定协议
* TCP/IP设计之初就已经考虑了异构网互联问题,将IP作为重要层次
* OSI的网络层是无连接+面向连接的,传输层是面向连接的.而TCP/IP与OSI相反.

5层参考模型,综合OSI和TCP/IP的优点:

* 应用层 : 支持各种网络应用
* 传输层 : 负责进程之间的数据传输
* 网络层 : 源主机到目的主机的数据分组路由与转发
* 数据链路层 : 把网络层传下来的数据报组装成帧
* 物理层 : 实现比特传输



## 物理层

物理层解决的是如何在连接各种计算机的传输媒体上传输数据比特流,而不是指具体的传输媒体.

由上面的分层模型中,我们直到,物理层是确定与传输媒体接口有关的一些特性的,也就是定义接口的标准.它定义的特性:

* 机械特性 : 定义物理连接的特性,固定物理连接时采用的规格,接口形状,管脚数量,排列情况等
* 电气特性 : 规定传输二进制位时,线路上信号的电压范围,传输速率,距离限制等
* 功能特性 : 规定某条先上某一点评表示何种意义,接口部件的信号线的用途.
* 规程特性 : 也叫过程特性,定义各物理线路的工作规程和时序关系.

### 通信基础

我们先来看看典型的数据通信模型:
主机A----(数字信号)------调制解调器-------(模拟信号)------公用电话网---------(模拟信号)-------调制解调器----------(数字信号)--------主机B.

相关术语:

* 数据 : 传送信息的实体,通常是有意义的符号序列
* 信号 : 数据的电气/电磁的表现,是数据在传输过程中的存在形式,有数字信号和模拟信号两种形式.
* 信源 : 数据产生的源头
* 信宿 : 接受数据的终点
* 信道 : 信号的传输媒介,一般用来表示向某一个方向传送信息的介质,以此一条通信线路往往包含一条发送信道和一条接受信道

数据通信中的三种方式:

从通信双方信息的交互方式 : 单工(只需要一条信道),半双工(需要两条信道),全双工(需要两条信道)

传输方式 :

* 串行传输 : 只能一个个比特发送数据,速度比较满,速度比较慢,适合长距离数据传输.而且只需要一条信道,成本低
* 并行传输 : 可以同时传送多个数据和接受数据,速度很快,但是需要的信道多,适合近距离.

一些名词:

* 码元 : 指用一个固定时长的信号波形(数字脉冲),代表不同离散数值的基本波形,是数字通信中数字信号的计量单位,这个时长内的信号称为k进制码元,而该时长称为码元宽度.当码元的离散状态有M个时,此时码元维M机制码元.1码元可以携带多个比特的信息量.比如在使用二进制编码的适合,只有两种不同的码元,一种代表0状态,一种代表1状态.

* 速率,波特,带宽

  速率指的是数据的传输速率,表示单位时间内传输的数据量(单位时间内能向信道上发送多少数据),区别于传播速率.可以用码元传输速率和信息传输速率表示.

  码元传输速率 : 别名码元速率,波形速率,符合速率等.它表示单位时间内数字通信系统所传输的码元个数(也可以说是脉冲个数或信号变化的次数),单位是波特.1波特表示数字通信系统每秒传输一个码元.码元速率于码元进制无关.

  信息传输速率 : 别名信息速率,表示单位时间内数字通信系统传输的二进制码元个数(也就是比特数),单位是比特/s.

  如果一共码元携带了n比特的信息,则M波特的码元传输速率对应的信息传输速率维M*n比特/s.

  带宽表示在单位时间内从网络中的某一点到另一点所能通过的"最高数据率",常用来表示网络的通信线路所能传输的能力.单位是比特/s.

信号失真:

现实中的信道在传输信号的时候,会因为带宽受限,噪声和其它的干扰会导致信号在接受到的时候,会接收到不完全的信号.影响失真的因素

* 码元传输速率
* 信号传输距离
* 噪声干扰
* 传输媒体质量

失真的一种现象 : 码间串扰.也就是接收端收到的信号波形失去了码元之间清晰界限的现象.当码元传输速率极快的话,就会导致这种现象.

信道带宽 :信道能通过的最高频率和最低频率的差.

### 两个极限公式

奈式准则和香农定理,注意一下,在这两个公式里的带宽(W)单位是赫兹

* 奈式准则

  在理想低通条件下(无噪声,带宽受限),为了避免码间串扰,极限码元传播速率为2*W波特.W是信道带宽,单位是赫兹.把它转成数据传输速率的话就是:

  理想低通信道下的极限数据传输速率 : 2log2V*W(比特/s).这个V表示码元的离散电平数量

  * 在任何信道中,码元的传输速率是由上限的.如果传输速率超过此上限,就会产生严重的码间串扰问题.使得接收端对码元的识别基本没法做到
  * 信道的频带越宽(也就是能通过的信号高频分量越多),就可以使用更高的传输速率进行码元的有效传输
  * 奈式尊者给出的是码元传输速率的限制,并没有对信息传输速率给出限制
  * 由于码元的传输速率受奈式准则的制约,所以要提高数据的传输速率,就必须设法使每个码元能携带的比特信息量更多,这就需要采用多元制的调制方法

* 香农定理

  噪声会存在于所有电子设备和通信信道中,因为它的随机性,它的瞬时值有有时候会很大,因此噪声会使得接收端对码元的判定产生错误.但是噪声的影响是相对的,如果信号比较强,那么噪声影响就会相对较小.所以信噪比就很重要.它等于信号的平均功率/噪声的平均功率,常记为S/N,并用分贝(db)作为度量单位.

  信噪比(db) = 10lg(S/N)

  香农定理 : 在带宽受限且有噪声的信道中,为了不产生误差,信息的数据传输速率有上限值.这个上限值为:
  												信道的极限数据传输速率  = W * log2(1+S/N)(b/s)

  * 信道的带宽或信道中的信噪比越大,则信息的极限传输速率就越高
  * 对一定的传输带宽和一定的信噪比,信息传输速率的上限就确定了
  * 只要信息的传输速率低于信道的极限传输速率,就一定能找到某种方法实现无差错传输
  * 香农定理指出的极限信息传输速率,实际能达到的传输速率是到不了这个值的.
  * 从香农定理可以看出,如果信噪比足够高,那么信道的极限信息传输速率就没有上限,不过这基本不可能

  

基带信号:将数字信号1/0直接用两种不同的电压表示,再送到数字信道上去传输(这个传输过程称为基带传输).这种基带信号是来自信源的,基带信号就是发出的直接表达了要传输信号的信号.

宽带信号:将基带信号进行调制后形成的频分复用模拟信号,再传送到模拟信道上去传输(称为宽带传输).这种信号就是把基带信号经过载波调制后,把信号的频率范围搬移到较高的频段以便在信道中传输(即仅在一段频率范围内能够通过信道).

在传输距离较远的时候,计算机网络采用宽带传输方式,因为远距离的信号衰减比较大,即使信号变化大也能最后过滤出基带信号.

在传输距离较劲的时候,计算机网络采用基带传输方式,因为近距离的信号衰减小,信号不易发生变化.

**编码和调制**

将数据转换成数字信号就是编码操作.将数据转换成模拟信号就是调制操作.

数字数据如果要编码所需要的设备是数字发送器,调制所需要的设备是调制器.

模拟数据如果要编码成数字信号就需要PCM编码器,调制就需要放大器调制器



* 数字数据编码为数字信号(具体实现伯度嗷)

  * 非归零编码
  * 曼彻斯特编码
  * 差分曼彻斯特编码
  * 归零编码
  * 反向不归零编码
  * 4B/5B编码

* 数字数据调制为模拟信号

  就是通过调制器的调制解调过程

  * 2ASK调制(调幅)
  * 2FSK调制(调频)
  * 2PSK调制(调相)
  * QAM调制(调幅+调相)

* 模拟数据编码为数字信号

  需要将模拟数据数字化才行,也就是通过采样,量化转换成有限个数字表示的离散序列.

  * PCM脉码调制(抽样,量化,编码)
    * 抽样 : 对模拟信号周期周期性扫描,把时间上连续的信号编程时间上的离散的信号.为了使所得的离散信号能够无失真的代替被抽样的模拟数据,要使用采样定理进行采样(f采样频率 >= 2f信号最高频率)
    * 量化 : 把抽样取得的电平幅值按照一定的分级标准转换为对应的数字值,并取整数
    * 编码 : 把量化的结果转换为与之对应的二进制编码

* 模拟数据调制为模拟信号

  为了实现传输有效性,可能需要较高的信号频率.这种调制方式还会使用频分复用技术,充分利用带宽资源,在电话机和本地交换机所传输的信号是采用模拟信号传输模拟数据的方式,模拟数据是加载到模拟的载波信号中进行传输的.

### 物理层设备

传输媒体这种东西它只作为数据传输的通路.不属于物理层.咱就先不管了.

常见的物理层设备有中继器和集线器.

中继器 : 因为信号传输可能存在损耗,在线路上传输的信号功率会逐渐衰减,衰减到一定程度使会导致信号失真.它就是为了解决这个问题的.它可以对信号进行再生和还原.对衰减的信号进行方法,保持与原数据相同,以增加信号传输的距离.延长网络的长度.

集线器(多端口的中继器) : 功能类似于中继器,也是给信号进行再生和放大的.它就是对信号进行再生放大,然后转发到其他所有处于工作状态的端口上.它不具备信号的定向传送能力,是一共共享式设备.





## 数据链路层

在网络中,我们知道有节点和链路这两个东西

* 节点 : 主机,路由器
* 链路 : 网络中两个节点之间的物理通道,链路的传输介质主要有双绞线,光纤和微波,也就是有线链路和无线链路.
* 数据链路 : 两个节点之间的逻辑通道,把实现控制数据传输协议的硬件和软件加到链路上就构成了数据链路
* 帧 : 链路层的协议数据单元,封装网络层数据报.

数据链路层负责通过一条链路从一个节点向另一个物理链路直接相连的相邻节点传送数据报.

### 链路层的功能

数据链路层在物理层提供服务的基础上向上层的网络层提供服务,其最基本的服务是将源自网络层的数据可靠的传输到相邻节点的目标主机的网络层,其主要作用是加强物理层传输原始比特流的功能,将物理层提供的可能出错的物理连接改造成逻辑上无差错的数据链路,使之对网络层表现为一条无差错的链路.

数据链路层的具体功能:

* 为网络层提供服务.包括:无确认无连接服务,有确认无连接服务,有确认面向连接服务.

* 链路管理.也就是管理连接的建立,维持,释放(对于面向连接的服务)

* 组装数据帧与透明传输

  * 封装成帧

    就是在一段数据的前后添加首部和尾部,这样就是完成了一个数据帧的封装.接收端在收到物理层上交的比特流后,就能够根据首部和尾部信息,从收到的比特流中识别帧的开始和结束.

    首部和尾部包含许多的控制信息,它们的一个重要作用就是帧定界(确定帧的界限,这个是帧定界符来确定的).数据链路层的帧长就是帧首部和尾部以及其中间的数据部分组成.帧的数据部分存在限制,根据协议的不同,限制的长度会不一样,这个限制的长度称为最大传送单元MTU.

    封装成帧的四种方法:

    * 字符计数法

      帧首部使用一个计数字段(也就是第一个字节)来标明帧内的字符数.但是这种方法有个问题,就是因为很多的帧会连着,如果有一个首部出问题,就会导致一堆数据出问题

    * 字节/符填充法

      以一个字节作为帧首部,另一个字节作为帧尾部.首尾的字节组合可以是任意的,根据协议来定.它实现很简单而且不容易出问题,但是这种方式只适合传送由文本文件组成的数据.因为其他类型的数据的话可能会出现和帧首位字节一样的比特组合,导致识别首位出错,此时需要字符填充法来解决这个问题(在与结束字符或者起始字符相同的数据位前加入一个转义字节,用来标识这个东西并不是真正的帧首或者帧尾,识别的时候需要跳过这个,对于出现与转移字节的比特组合一样的也是在它前面加一个转移字节.)

    * 零比特填充法

      使用相同的标识符作为数据帧的首尾,首尾的标识符一样,如果在数据部分中发现了跟首尾标识符长的一样的比特组合就这样做:

      * 在发送端,扫描整个信息字段,只要发现有连续5个1比特出现,就在它后面填一个0比特
      * 在接收端,先找到标志字段确定边界,再用硬件对比特流进行扫描,发现有连续5个1比特,就把后面的0比特删掉.

      这种方式可以发送任意类型的数据.这个也是使用的非常广泛的

    * 违规编码法

      在曼彻斯特斯特编码中,比特1可以转换成高-低的电平组合,比特0可以转换成低-高的电平组合.而不会出现高-高,低-低这种编码组合.所以在这种封装帧的方式,就会使用这种不会使用进码元编码中的电平组合来进行首位标志的封装.是使用的最普遍的方法

  * 透明传输

    指不管传输什么样的比特组合,都能够在链路上传输,因此链路层看不到有啥会妨碍数据传输的东西.如何保证数据的透明传输嘞 : 当所传数据中的比特组合恰巧与某一个控制信息完全一样的时候,就必须采取适当的措施,防止接收方不会将这样的数据误认为是某种控制信息,这样才能够保证透明传输.

* 流量控制(限制发送方发送数据的速度)与可靠传输机制

  * 流量控制

    这里注意以下数据链路层和传输层的流量控制的区别 : 数据链路层的流量控制是点到点的,而传输层的流量控制是端到端的.数据链路层的流量控制手段是接收方收不下数据后就不回复确认信息了.传输层的流量控制手段是接收方接受不下数据后会给发送端一个窗口提示.

    数据链路层流量控制的方法:

    * 停止-等待协议

      算是一个特殊的滑动窗口协议,因为它的窗口就只有一个.

      每发送完一个帧就停止发送,等待对方的确认,在收到确认后再发送下一个帧.

      发送方会维护一个发送窗口,接收窗口维护一个接受窗口,这个发送窗口只有一个,接受窗口只有一个,在消息发送的时候发送窗口就会向后滑动,接受窗口收到数据后就会向后移动一个位置然后发送一格确认帧信号,只有发送方接收到这个确认帧后才可以继续发送.如果长时间收不到确认信号,那么发送端就会重新发送这个帧的副本,直到收到确认信号.

    * 滑动窗口协议

      * 后退N帧协议(GBN) : 发送窗口>1,接收窗口=1
      * 选择重传协议(SR) : 发送窗口 >1,接收窗口 > 1

  * 可靠传输

    就是发送端发送什么数据,接收端就收到什么数据.流量控制和差错控制就是实现可靠传输的机制.

* 差错控制(帧错/位错)

  链路无完链路,总是会产生噪声的,噪声包括全局噪声(链路的固有属性所导致的热噪声等随机噪声),以及局部性噪声(外界某种原因对信号的干扰).对于全局噪声来讲,可以通过提高信噪比来减小影响,对于局部噪声可以通过编码技术来解决.具体的错误有以下情况:

  * 位错

    即比特位出错,1变成0,0变成1这种情况

  * 帧错

    * 丢失 : 比如收到了1数据帧,丢失了3数据帧
    * 重复 : 重复收到某个数据帧
    * 失序 : 接收的帧顺序与帧发送顺序不一致

  对于这些问题,链路层它有差错控制和重传机制来保证数据的正确性.在数据链路上主要处理的问题还是位错,对于帧错和重传,是可以放在传输层去解决的.

  位错的解决方法:

  * 检错编码
    * 奇偶校验码
    * 循环冗余码CRC
  * 纠错编码
    * 海明码

  这里的编码跟数据编码不是一个概念.在物理层的编码是对一个比特进行的,而数据链路层这里的编码是对一组比特进行的,它通过冗余码(就是在数据发送前,先按某种关系附加上一定的冗余位,构成一个符合某一规则的码字后再发送.当数据发生变化时,冗余位也会发生变化,使码字遵从不变的规则.接收端根据收到的码字是否符合原规则来判断是否出错)的技术实现一组二进制比特串在传输过程是否出现差错.

### 链路层的两种信道

* 点对点链路
  两个相邻节点通过一个链路相连,没有第三者.比如常用于广域网的PPP协议,

* 广播式链路

  早期的总线以太网,无线局域网,常用于局域网.

**介质访问控制**

两对节点之间的通信不应该互相干扰,介质访问控制就是干这个的

* 静态划分信道
  * 频分多路复用
  * 时分多路复用
  * 波分多路复用
  * 码分多路复用
* 动态划分信道
  * 轮询访问介质访问控制 : 令牌传递协议
  * 随机访问介质访问控制
    * ALOHA协议
    * CSMA协议
    * CSMA/CD协议
    * CSMA/CA协议

### 局域网和广域网以及这一层次的协议

**局域网及其体系结构**

局域网简称LAN,是指在某一区域内由多台计算机互联成的计算机组,使用广播信道.

它的特点:

* 覆盖地理范围小
* 使用专门铺设的传输介质进行联网,数据传输速率高
* 通信延迟时间端,误码率低,可靠性高
* 各站为平等关系,共享传输信道
* 多采用分布式控制和广播式通信,能进行广播和组播
* 决定局域网的主要因素为 : 网络拓扑,传输介质和介质访问控制方法

局域网主要使用的拓扑结构

* 星型拓扑
* 总线型拓扑
* 环形拓扑
* 树形拓扑

局域网的介质访问控制方法

* CSMA/CD

  产用于总线型局域网,也用于树形网络

* 令牌总线

  产用于总线型局域网,也用于树形网络

* 令牌环

  用于环形局域网,如令牌环网.

局域网的分类

* 以太网 : 最常用的局域网,包括标准以太网,快速以太网,千兆以太网,10G以太网,符合IEEE802.3系列规范,逻辑拓扑总线型,物理拓扑为星型或扩展星型.使用CSMA/CD协议

  以太网实现的是无连接的,不可靠的服务.也就是通信双方是不需要握手进行连接的.并且不会对发送方的数据帧编号,接收方不会向发送方进行确认,对于差错帧直接进行丢弃,差错纠正由高层来负责.

  在计算机上,与外界有局域网的连接是通过通信适配器来进行的,也就是我们所说的网卡.也叫网络接口板,网络接口卡NIC等.它上面有处理器和存储器,它的存储器里记录了计算机的硬件地址,也就是MAC地址.在局域网中,硬件地址又称为物理地址,或者MAC地址,这个地址就是计算机的标识符.

  MAC地址 : 每个适配器有全球唯一的一格48位二进制地址,前24位代表厂家,后24位厂家自己指定,常用6个十六进制数来表示.

  MAC帧 : 就是数据链路层封装好的数据帧(来自数据链路层的MCU),目前最常用的是以太网V2格式的MAC帧.它的构成:6字节的目的地址+6字节源地址+2字节的类型+来自网络层的IP数据报(46~1500字节)+4字节的FCS(CRC协议的一个帧检验序列).

* 令牌环网

* FDDI网

* ATM网

* 无线局域网

**PPP协议**

广域网 : WAN,通常跨接很大的物理范围,它能够连接多个城市与国家,横跨多个洲,形成国际性的远程网络.
广域网的通信子网主要使用分组交换技术,广域网的通信子网可以利用公用分组交换网,卫星通信网和无线分组交换网,它能够讲分布在不同地区的局域网或者计算机系统连接起来,达到资源共享的目的.比如因特网就是世界范围内最大的广域网.
世界上各个局域网由节点交换机接入广域网中.
**PPP**协议 : Point-to-Point,点对点的协议.它是广域网中使用的最广泛的协议之一.

它应该满足的要求:

* 简单 : 对于链路层的帧,无需纠错,无需编号,无需流量控制.
* 封装成帧 : 就是加上帧定界符
* 透明传输 : 与帧界定符一样的比特组合的数据如何处理:异步线路用字节填充,同步线路用比特填充
* 多种网络层协议 : 封装的IP数据报可以采用多种协议
* 多种类型链路 : 支持各自类型的链路
* 差错检测 : 错就丢弃
* 检测连接状态 : 检查链路是否正常工作
* 最大传送单元 : 数据部分最大长度MTU
* 网络层地址协商 : 需要让通信双方知道各自的网络层地址

它的组成:

* 一个将IP数据报封装到串行链路(同步/异步串行)的方法
* 链路控制协议LCP : 建立并维护数据链路连接
* 网络控制协议NCP : PPP支持多种网络层协议,每个不同的网络层协议需要一个相应的NCP来配置,为网络层协议建立和配置逻辑连接.
* 它的帧格式可以自己去康

**HDLC协议**

即高级数据链路控制协议,是一个在同步网上传输数据,面向比特的数据链路层协议,它是由IOS组织根据IBM公司的SDLC协议扩展开发而成.它不属于TCP/IP.
该协议可以实现透明传输,使用的是0比特插入法.它和PPP协议一样,只支持全双工的链路.

HDLC的站:

* 主站
* 从站
* 复合站

根据站,HDLC有三种数据操作方式:

* 正常响应方式
* 异步平衡方式
* 异步响应方式

它的帧格式也可以自己去康.

**PPP协议和HDLC协议的区别**

* PPP协议是面向字节的,HDLC协议是面向比特的
* 它们都可以实现透明传输和差错检测,但是不会纠正差错.并且都是只支持全双工链路
* PPP协议不会给帧编号,也没有确认机制,所以它是不可靠的
* HDLC协议回对帧进行编号,并且有确认机制,所以它是可靠的.
### 链路层设备

在链路层的设备主要有网桥和交换机,它们是在链路层对以太网进行扩展的设备.

* 网桥
  
  网桥会根据MAC帧的目的地址对帧进行转发和过滤,当网桥收到一个帧的时候,并不会向所有接口转发这个帧,而是会先检查这个帧的目的MAC地址,然后再确定将该帧转发到哪一个接口,或者把它丢弃掉(过滤).
  各个网桥之间的冲突域称为网段,它是指一个计算机网络中使用同一物理层设备,能够直接通信的那一部分.
  网桥能够过滤通信量,增加吞吐量.扩大物理传输范围.还提高了传输的可靠性.
  网桥还分为透明网桥和源路由网桥
* 交换机
  
  这个玩意可以独占传输媒体的总带宽.
  * 直通式交换机
  
    检查完谜底地址就立刻进行转发,这个方式延迟小,但是可靠性低
  * 存储转发式交换机
  
    将帧放入高速缓存,并检查是否正确,正确就转发,错误就丢弃,这个方式延迟比较大,但是可靠性很高.

## 网络层

网络层的主要任务是把分组从源端传送到目的端,为分组交换网上的不同主机提供通信服务.网络层传输单位是数据报

网络层的具体功能:

* 路由选择和分组转发

  通过路由选择算法,选择一条最佳的路由路径进行数据转发.
* 异构网络互联

  通过不同的网络(比如校园网,运营商网络等)通过路由器(网路层的核心设备)可以互相通信.
* 拥塞控制

  如果所有节点都来不及接受分组,而要丢弃大量分组的话,网络就会处于拥塞状态.因此需要采取某种措施去缓解这种问题.解决方法:
  * 开环控制
  * 闭环控制

###数据交换方式
在异构网络中如何从源主机到目的主机进行通信呢?就是通过数据交换的方式!
目前常用的数据交换方式是通过交换网络实现的.
具体的数据交换方式:
* 电路交换
  
  典型的例子就是电话网络.它的阶段:
  1.建立连接(呼叫,建立连接电路)
  2.进行通信
  3.释放连接(拆除电路)
* 报文交换

  报文指的是源主机发送的信息整体,比如需要发送的文件,就属于一个报文.这个报文如果比较大,经过传输层的时候可能会被进行分组.报文发送后,在交换设备上(比如交换机)可以暂时放在那里(也就是存储转发技术,能够动态分配链路),当有链路空闲的时候,报文就可以继续转发,知道最后交付到目的主机.
* 分组交换
  分组就是把大的数据块分割成小的数据块.这些数据块可以一样大也可也不一样大.发送的时候是按分组进行发送的,直到所有的分组都发送到了目的主机.
  * 数据报分组

    数据报分组方式为网络层提供无连接服务(不会事先为分组的传输确定路径,每个分组独立去欸的那个传输路径,不同分组传输路径可能不同).每个分组携带了源地址和目的地址,路由器会根据分组的目的地址进行转发分组(基于路由协议/算法构建转发表,检索转发表,每个分组独立选择传输链路).
  * 虚电路分组

    虚电路分组方式为网络层提供连接服务(首先为分组的传输确定传输路径,也就是一个建立连接的过程,然后沿着该连接传输系列分组,系列分组传输路径相同,传输结束后拆除连接).这个方式是把数据报方式和电路交换方式相结合.
    方式:一条源主机到目的主机类似于电路的路径(逻辑连接),路径上所有节点都要维持这条虚电路的建立,都维持一张虚电路表,每一项记录了一个打开的虚电路的信息.它的具体通信过程:
    建立连接(虚电路建立,每个分组携带虚电路号,而非目的地址.源主机发送呼叫请求进行分组并收到呼叫应答后才算建立连接)---->数据传输(全双工)------->释放连接(虚电路释放,源主机发送释放请求,分组以拆除虚电路)

几种传输单元名词的辨析:
* 报文 : 应用层的数据传输单元,可以是各自文件啥的
* 报文段 : 传输层的数据传输单元,是报文被切割后的产物
* IP数据报(分组) : 报文端再次被分割就变成了分组,封装上网络层的PCI就变成了IP数据报
* 帧 : 分组到了数据链路层就会被封装成一个数据帧
* 比特流 : 帧到了物理层就会被转换成比特流,方便拿去链路上传输

**路由算法**

  路由算法是决定路由表的每一项的.它还会决定最佳路由,也就是最佳的路由路径,这个最佳只剩相对于某一种特定要求下得出的较为合理的选择.
* 静态路由算法(非自适应路由算法)

  由管理员手动配置路由信息
* 动态路由算法

  路由器之间彼此交换信息,并会按照路由算法优化出路由表项 
  * 链路状态路由算法[OSPF协议](全局性)
    
    所有路由器掌握完整的网络拓扑和链路费用信息
  * 距离相连路由算法[RIP协议](分散性)

    路由器只掌握物理相连的邻居及链路费用
**路由协议**

* 分层次的路由选择协议
  * 内部网关协议IGP
  * 外部网关协议EGP

**IP数据报**

在TCP/IP协议栈中,网络层的主要的协议有:IP协议,ICMP协议,IGMP协议,ARP协议.其中IP协议是最为重要的一个协议.
IP数据报的格式:整个IP数据报的格式由首部和数据部分(TCP/UDP段)组成,当IP数据报过大的时候,会对它进行分段,分段的结果就是网络层的数据单元:分组.

首部分为两个部分:固定部分(固定不变的,对于任意一个IP数据报,都必定有一个固定部分,它的大小是20个字节)+可变部分(对于IP数据报来说可有可无).它具体的结构如下:

固定部分:

第1-4个字节 : 0-4位:版本(IPV4还是IPV6),5-8位:首部长度(单位是4B,最小为5),9-16位:区分服务(期望获得哪种类型的服务),17-31位:总长度(IP数据报的长度,单位是1字节).

第5-8个字节 : 0-15位:标识(),17-19位:标志,20-31位:片偏移

第9-12个字节: 0-7位:生存时间(TTL,标识IP分组的保质期,每经过一个路由器就-1,如果变成0就会被丢弃,用这个就是防止无法被交付的数据报在网络中无限的进行转发),8-16位:协议(数据部分使用的协议,一般有这些[ICMP,IGMP,TCP(标志值为6),EGP,IGP,UDP(标志值为17),IPV6,ESP,OSPF]),17-31位:首部检验和(只检验首部,检验方法就是二进制求和)

第13-16个字节:源地址(就是源主机的IPV4地址)

第17-20个字节:目的地址(就是目的主机的IPV4地址)

还有4字节的可变部分用来支持排错,测量以及安全等措施的.

还记得数据链路层的最大传送单元MTU不,以太网的MTU是1500,也就是传送到数据链路层的IP分组最大长度是1500字节.如果我们要传送的IP数据报长度超过了MTU怎么办嘞,就得进行数据分片.进行分组分片的前提是该分组允许分片.分片就跟IP数据报首部的第5~8个字节的标识,标志和片偏移有关了.

* 标识:同一数据报的分片使用同一标识,也就是分片后,首部中的标识都是一样的,好识别出来这些分片是一个数据报.
* 标志 : 它有三位,但只有两位有意义 : x_ _ .x是保留位,后面那两位才是有意义的.中间的位置DF标识是否允许分片,1是禁止分片,0是允许,右边的位置MF表示后面是否还有分片,1表示后面还有分片,0表示这个分片是最后一个分片.
* 片偏移 :它有13位,指出较长分组分片后,某个分片在原分组中的相对位置,以8字节为单位.所以除了最后一个分片,每个分片长度必然是8字节的整数倍.

#### IPV4地址

在网络中,一台主机需要知道目标主机在哪个网络,在那个网络中的那个主机,才能跟它建立通信.而IP地址就是标识主机的一个东西,它能够标识全世界上每一台主机.也就是说,每一台主机它的IP地址都是唯一的.

##### IP编址的历史阶段:

* 分类的IP地址

  IP地址就像我们的身份证号码一样.它上面的码是对应特定信息的.

  IP地址是一个32位的也就是一个4字节的标识符.它标识的是路由器主机的接口.它由两个字段构成:网络号+主机号.我们一般会把它以点分十进制的方式写出来.

  IP地址的分类(分类依据网络号的长度.):

  * A类:第一个字节为网络号,其他的是主机号,并且网络号的第一位为0.该类网络的地址范围为:10.0.0.0---->10.255.255.255.它只有一个网段,也就是10打头的这个网段.它最大可用网络数有2的7次幂-2个.第一个可用的网络号就是1,最后一个可用的网络号就是126.每个网络中最大主机数就是2的24次幂-2台.
  * B类:第1,2个字节为网络号,其他是主机号,并且网络号第1,2位为1,0.,该类网络的地址范围为:172.16.0.0----->172.31.255.255.它有16个网段,也就是172.16~172.31这些.它最大可用网络数有2的14次幂-1个,第一个可用的网络号就是128.1,最后一格可用的网络号就是191.255,每个网络中的最大主机数有2的16次幂-2台
  * C类:第1,2,3个字节为网络号,其他是主机号,并且网络号第1,2,3位为1,1,0.该类网络的地址范围为192.168.0.0--->192.168.255.255,也就是192.168.0~192.168.255这些.它的最大可用网络数有2的21次幂-1个,第一个可用的网络号为192.0.1,最后一个可用的网络号为223.255.255.每个网络中的主机数最大有2的8次幂-2台.
  * D类:这类是多播(一对多通信)地址,它的前四位为1110.
  * E类:这类是保留的,留着以后用,虽然IPV4已经不够用了,它的前4位为1111.

  有一些特殊的IP地址我们是需要注意的:

  * 网络号全0,主机号全0 : 可以作为IP分组的源地址,但不能作为IP分组的目的地址.这种在本网范围内表示主机(也就是自己发送东西到时候不知道自己是哪个),路由表中用于表示默认路由(也就是表示整个因特网网络)
  * 网络号全0,主机号是特定值的 : 不能用作IP分组的源地址,可以作为IP分组的目的地址.这种就是在本网内表示某个特定主机
  * 网路号全1,主机号全1:不能作为IP分组的源地址,可以作为IP分组的目的地址,这种是表示本网广播地址的(路由器不转发).
  * 网络号为特定值,主机号全0 : 这种不能作为IP分组源地址和目的地址,这种是表示网络地址的,也就是表示一个网络
  * 网络号为特定值,主机号全1:这种不能作为IP分组的源地址,但可以作为目的地址,他表示的是直接广播地址,对特定网络上的所有主机进行广播
  * 网络号为127,主机号为任何数(非全0/1)的:可以作为IP分组的源地址和目的地址,这种是用作本地软件环回测试的,也成为环回地址.

  这些IP地址是私有的,也就是说,它们是在单位啊,组织内啊,公司内啊等等这些地方内部可分配的IP地址,在广域网中路由器是无法识别这些私有IP地址的.路由器对于目的地址是私有IP地址的的数据报一律不会进行转发.那我们又是如何通过私有IP地址去和外部互联网进行通信呢?这就是NAT网络地址转换技术所做的事.NAT是一个软件,它可用安装在连接专用网和因特网的路由器上.安装了该软件后,它就变成了一个NAT路由器,它至少有一个有效的外部全球IP地址.NAT的核心是一个NAT转换表,它有两个部分,就是广域网和本专用网的IP:端口的映射.

* 子网划分

  在上面的IP地址分类中,是存在一些问题的,首先就是IP地址空间的利用率有时会很低.而且两级的IP地址不够灵活.所以就出现了子网划分.子网划分就是把主机号中的一部分拿出来当作子网号,此时就变成了三级IP地址(网络号+(子网号+主机号)).划分子网后,对外仍然表现为一个网络,也就是说本单位外的网络看不见本单位内子网的划分.

  子网掩码是用来识别数据报的目的地址是在哪个子网中的.二级IP地址的子网掩码在网络号部分都是1,主机号部分都是0,三级IP地址的子网掩码中网络号和子网号都是1,主机号部分是0.它区分子网的方法是使用子网掩码和给定的IP地址(也就是路由器收到的那个数据报中的目的地址)逐位相与,就可以得到子网的网络地址.

* 构成超网(无分类编址)

  在上面的子网划分中,IP地址也是有限的,因此就又出现了无分类编址CIDR技术.也称作无分类间域路由选择CIDR.它消除了传统的ABC类地址以及划分子网的概念.它的IP地址变成了网络前缀和主机号,就类似于网络号和子网号合体了.它的记法:IP地址后加上/,然后写上网络前缀(可用任意长度)的位数.比如这样128.14.32.0/20.20就表示网络前缀有20位.CIDR把网络前缀都相同的IP地址组成一个CIDR地址块.

  将多个子网聚合成一个较大的子网,就叫做构成超网,也叫路由聚合.我们只需要把网络前缀缩短就行.比如:

  206.1.0.0/17和206.1.128.0/17,可以合并成206.1.0.0/16.

  在使用CIDR的时候,查找路由表可能会得到几个匹配结果,因为有路由聚合的操作.此时我们应该选择具有最长网络前缀的路由.因为网络前缀越长,地址块越小,路由越具体.

#### ARP协议

对于每一个主机和路由器,都存在一个ARP高速缓存,它是用于存储IP地址和MAC地址的映射的.这个MAC地址是在数据链路层进行封装的,而目的地址的MAC地址就是从这个ARP高速缓存里拿的,如果这个高速缓存里面没有怎么办?这时就是ARP协议要做的事了:

首先进行一个ARP请求分组(它其实是一个数据帧)(自己的IP地址+目的主机的IP地址+自己的MAC地址+全1的MAC地址(来表示一个广播,向所有的主机进行广播)).它的意思就是去问目的主机它的MAC地址是多少.当目的主机收到了这个广播,它就会进行一个单播ARP响应分组(自己的IP地址+自己的MAC地址),它只会响应给那个进行ARP请求分组的机器.MAC地址这个东西只有主机和路由器的端口有.

如果在进行ARP请求分组的时候发现,自己要通信的主机并不在与自己一起的这个子网里面,那么就会去请求那个默认网关,也就是本子网与外界相连的路由器.此时它在数据链路层封装的目的MAC地址应该是这个默认网关的MAC地址.路由器之间也是这样的一个过程.

总结来说,ARP协议就是完成主机或路由器的IP地址到MAC地址的映射,也就是解决下一跳应该往哪走的一个问题.

ARP协议的4种情况:

* 主机A发给本网络上的主机B : 用ARP找到主机B的MAC地址
* 主机A发给另一个网络上的主机B : 用ARP找到本网络上的路由器,也就是网关的MAC地址
* 路由器发给本网络的主机A : 用ARP找到主机A的MAC地址
* 路由器发给另一个网络上的主机B : 用ARP找到本网络上另一个路由器的MAC地址

#### DHCP协议

主机在通信的时候要具备IP地址,那主机是怎么获取IP地址的嘞?

* 静态配置

  就是提前固定好主机的IP地址.就像学校里面的机房一样,这种需要配置IP地址,子网掩码,默认网关.

* 动态配置

  比如在学校里面有校园网这种东东,但是网络覆盖也是有限的,而我们的手机,ipad都是移动设备,当进入不同的教学楼,连上校园网的时候,IP地址不可能一直都一样.此时的IP地址是由DHCP服务器来进行分配的.每次IP的分配在移动主机断开连接后就会被收回.

DHCP协议,也就是动态主机配置协议它是一个应用层的协议.使用客户/服务器的模式,客户端和服务器通过广播方式进行交互,基于UDP.DHCP协议提供即插即用的联网机制,主机可用从服务器动态的获取IP地址,子网掩码,默认网关,DNS服务器名称及其IP地址.允许地址重用(就相当于线程池一样,当主机走了,就回收IP地址,等着下次分配.),支持移动用户加入网络,支持再用地址续租(IP地址的分配是有时间限制的,当超时后,IP就该被回收,续租就是当前使用的IP时间延长).它的过程(比如我们从没网的地方走到一个教学楼/宿舍连上校园网):

* 主机广播DHCP发现报文 : 看附近有没有DHCP服务器,试图找到DHCP服务器,如果有,DHCP服务器就会获得一个IP地址
* DHCP服务器广播DHCP提供报文 : DHCP服务器响应,服务器拟分配给主机一个IP地址以及相关的配置,先到先得.
* 主机广播DHCP请求报文 : 主机请求使用分配得到的IP地址.这个时候为啥是广播嘞?因为在范围内可能有多台DHCP服务器,但主机只需要一个DHCP服务器提供的IP地址.广播的话就可以告知其他DHCP服务器说我以及有得用了,你们的就先收回.
* DHCP服务器广播DHCP确认报文 : DHCP服务器确认主机使用分配的IP地址.此时才正式的将IP地址分配给主机.

#### ICMP协议

ICMP协议,网际控制报文协议是为了更有效的转发IP数据报和提高交付成功的机会的.它是传输层和网络层之间的一个协议,相当于一个传输层和网络层的桥梁.

当数据报因为某些原因丢弃的时候,咱也不能只是丢弃啊,肯定要告诉别人啊.ICMP就是干这个的.

ICMP协议支持主机或者路由器,它是用来发送特定ICMP报文的.ICMP报文是转载到IP数据报种的数据部分的.ICMP报文是由8字节的首部和ICMP数据部分构成的.前4字节是类型,代码和检验和.

ICMP的报文类型有两种:

* 差错报告报文
  * 终点不可达 : 数据报无法交付
  * 源点抑制(现在基本不会用了) : 因为拥塞导致的数据报丢失
  * 超时 : 因为TTL=0导致数据报寄了,就会把已经收到的数据报片都丢弃了,然后向源点发送一个超时报文
  * 参数问题 : 首部字段出错导致数据报丢弃
  * 路由重定向:路由器把改变路由报文发给主机,让主机知道下次应该将报文发送给跟好的路由

* 询问报文
  * 回送报文和回答报文 : 主机或路由器向特定目的主机发出的询问,收到此报文的主机必须给源主机或者路由器发送ICMP回送回答报文.这个可用来检查目的站是否可达以及了解目的站的相关状态.比如我们那个ping命令就是通过这种类型的ICMP报文来搞的
  * 时间戳请求和回答报文 : 请某个主机或者路由器回答当前的日期和时间.用来进行时钟同步和时间测量的
  * 掩码地址请求和回答报文 : 已经不用了
  * 路由询问和通告报文 : 已经不用了

ICMP数据报的打包和装入发送:

![ICMP数据报](D:\C++学习笔记\pictures\ICMP数据报.PNG)



ICMP差错报文不一定是每次出问题都要发的,不要发ICMP差错报文的情况:

* 对ICMP差错报文不要再发送ICMP差错报告报文了.
* 对第一个分片的数据报片的所有后续数据报片都不要发送
* 对具有组播地址的数据报都不发送
* 对具有特殊地址的数据报不发送



ICMP协议的引用:

* ping : 就是我们在cmd上敲的那个ping + 地址 命令.用来测试两个主机之间的连通性,使用的是ICMP回送请求和回答报文

* traceroute : 跟踪一个分组从源点到终点的路径,使用了ICMP时间超过差错报告报文.它的用法:

  整一堆的数据报,每一个报文它的TTL不相同,由1-多少不定.每到达一个路由器或者主机就可以返回一个差错报文.根据这些就可以测定源点到终点的路径了.



#### IPV6

之前的IPV4地址已经是快消耗殆尽了,CIDR和NAT技术都是治标不治本.而IPV6地址的出现,是从根本上解决了地址不够用的问题,也就是直接增加了大量的地址可选.IPV6不仅解决了地址不够用,它还改进了首部格式,并且引入了快速处理/转发数据报,还支持QOS(服务质量,指一个网络能够利用各种基础技术,为指定的网络通信提供更好的服务能力,是网络的一种安全机制,用来解决网络延迟和阻塞等问题的技术).

##### IPV6数据报

之前那个IP数据报是基于IPV4地址的,也可以说之前的IP数据报是IPV4数据报,现在的是IPV6数据报,它由40个字节的基本首部和不超过65535字节(64KB)的有效载荷构成.首部可以扩展.扩展首部是在有效载荷中的.就相当与IPV4数据报的那个可变部分.

基本首部(40个字节)的构成:

* 前4字节的0-4位:版本(指明协议版本,IPV6就是6嘛),4-12位:优先级,12-31位:流标签(流指的是互联网上从特定源点到终点的一系列数据报,所有属于同一个流的数据报都由同样的流标签)
* 下一个4字节的0-16位:有效载荷长度,16-24位:下一个首部,24-31位:跳数限制(相当于TTL,生存时间,到0的时候就丢了,然后返回ICMP超时差错报文)
* 下16字节:源地址
* 再下16字节:目的地址

IPV6相比于IPV4,地址空间极大增加,基本用不完了,然后就是检验和字段没了,减少了没跳的处理时间.并且IPV6的可选字段放到了数据段,成为了灵活的首部格式,因为放在数据段中,路由也不用去检查了,处理时间----.此外IPV6还支持即插即用,并且是自动配置的,不需要DHCP协议来搞了.IPV6只可以在主机处分片,因为它很大,而IPV4还可以在路由器里面分片,这点就有点蛋疼.IPV6还支持资源预分配,支持实时视像等要求,保证一定的带宽和时延的使用.IPV6还取消了协议字段,变成了下一个首部字段.

IPV6地址的表示就不能继续点分十进制来表示了,毕竟它长128比特...16个字节呢.所以我们可以用冒号十六进制的方法来表示.比如:1111:1111:1111:1111:1111:1111:1111:1111.但也好长啊,所以对于一组中连续相同的段,可以这样:   1:1:1:1:1:1:1:1

IPV6的地址分为单播(一对一通信,可作为源地址和目的地址),多播(一对多通信,可做目的地址),任播(多播中的一个通信,可作为目的地址)

IPV6作为新的一种IP协议,当前肯定还没从IPV4全部转换过来,有些地方也没必要转换,那么它们毕竟是不一样的版本,所以它们的过渡也是非常重要的,IPV6到IPV4的过渡策略有以下两种:

* 双协议栈

  双协议栈技术是指在一台设备上同时启用IPV4协议栈和IPV6协议栈.这样的话就能支持两种协议的通信了.如果这个设备是路由器,那么这个路由器的不同接口上分配了IPV4和IPV6地址,并很可能连接了IPV4网络和IPV6网络.如果这个设备是个主机,那它就是具备了处理这两个协议地址的功能.

* 隧道技术

  通过使用互联网的基础设施在网络间传递数据的方式.使用隧道传递的数据或负载可用是不同协议的数据帧或者包.隧道协议将其他的数据帧或者包重新封装然后通过隧道发送

#### RIP协议和距离向量算法

RIP是一种分布式的基于距离向量的路由选择协议,是因特网的协议标准,它的最大优点是简单.它要求网络中的每一个路由器都维护从它自己到其他每一个目的网络的唯一最佳距离记录,也就是一组距离.它的路由表就是这样的:目的网络+距离+下一跳路由.距离一般指的是跳数.进过一个路由器跳数+1,并且RIP允许一条路由最多只能包含15个路由器,如果路由器有16个以上,那么RIP就会认为目的网络是不可达的.因为这个原因,RIP协议是只适用于小型互联网的.

RIP协议和谁交换信息?多久交换一次?交换什么信息?

* 和谁:仅和相邻的路由器进行交换信息
* 交换啥:交换的信息是自己的路由表
* 多久交换一次:每30秒交换一次路由信息,然后路由器根据新信息更新路由表,如果超过3分钟还没有收到邻居路由器的通告,就判定链路寄了,并更新自己的路由表.

路由器刚开始工作的时候,只知道直接连接的网络的距离(就是1),接着每一个路由器也之和数目非常有限的相邻路由器交换并更新路由信息.经过若干次更新后,所有路由器最终都会知道到达本自治系统任何一个网络的最短距离和下一跳路由器的地址,也就是一个收敛的过程.

**距离向量算法**

流程:

* 修改相邻路由器发来的RIP报文中的所有表项

  对地址位x的相邻路由器发来的RIP报文,修改此报文中的所有项目:把下一跳字段中的地址改为x,并把所有的距离字段+1.

* 对修改后的RIP报文中的每一个项目,进行以下步骤

  * 一个路由器的路由表中没有目标网络,就把该项目填入该路由器的路由表
  * 一个路由器的路由表中有目标网络,就查看下一跳路由器的地址
    * 如果下一跳是x,就用收到的项目替换源路由表中的项目
    * 如果下一跳不是x,原来距离比从x走的距离更远则更新,否则就不更新

* 如果3分钟后还没收到相邻路由器x的根系路由表,就把x标记位不可达的路由器,把距离设置为16

* 循环这三个步骤\



**RIP 报文格式**

RIP的报文格式是存在于IP数据报的数据部分中的,RIP是应用层的协议,它使用的是UDP进行数据的传送,也就是它的报文放在UDP用户数据报中.它由4字节的首部和20字节的路由部分组成.



**RIP协议的特点**

当网络出现故障的时候,需要经过较长的时间,比如数分钟,才能将此信息传送到所有的路由器,也就是慢收敛问题.好消息能传的快,坏消息传的慢





#### OSPF协议和链路状态算法

OSPF也就是开放最短路径优先协议,它是开放的,也就是它不受某个厂商或组织所控制,是公开发布的.它名称中的SPF是Dijkstra提出的最短路径算法.所以它直接就叫做开放式最短路径优先.它最主要的特征就是使用了分布式的链路状态协议.

那么OSPF和谁交换信息?交换什么信息?多久交换一次?

* 和谁:使用洪泛法向自治系统内所有路由器发送信息,即路由器通过输出端口向所有相邻路由发送信息,而每一个相邻路由器也会这样发送信息给相邻路由器,也就是一种广播的方式
* 交换啥:发送的信息是本路由器和相邻所有路由器的链路状态(和谁相连,链路的代价等).
* 多久交换一次:只有在链路状态有变换的时候,路由器才会进行信息的发送.

最后,网络中的路由器都能建立一个链路状态数据库,也称作全网拓扑图.

**链路状态算法**

步骤:

* 每个路由器发现它的邻居节点会发送HELLO问候分组,并了解邻居节点的网络地址
* 设置每个邻居节点的成本度量metric
* 构造DD数据库描述分组,向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要项目
* 如果DD分组中的摘要自己都有了,那么邻站就不做处理,如果没有或者更新了,就发送LSR链路状态请求分组,请求自己没有的或者更新的信息
* 收到邻站的LSR分组后,发送LSU链路状态更新分组,进行更新
* 更新完成后,邻站返回一个LSAck链路状态确认分组,进行确认
* 使用SPF算法根据自己的链路状态数据库构造到其他节点间的最短路径

**OSPF报文格式**

关于OSPF属于那一层,主要说法有两种,一种是认为它是一种传输层的协议,另一种说法是它是一种网络层的协议.因为OSPF报文是可用直接用IP数据报传送的,所以我们可以认为它是网络层的协议.它也是存在于IP数据报种的数据部分的.



**OSPF协议的特点**

* 每隔一段时间,都要更新一次数据库中的链路状态
* OSPF协议适用于大规模互联网中.
* OSPF协议不存在坏消息传的慢的问题,它的收敛速度快的一批

#### BGP协议

BGP协议是外部网关协议.前面的RIP和OSPF两种协议是内部网关协议.

* 和谁交换信息 : 和其他AS的邻站BGP发言人(自治系统边界上与外界相连的一个路由器)交换信息
* 交换啥 : 交换网络可达性的信息,即要到达某个网络所要经过的一系列AS
* 多久交换 : 网络发生变化时

**BGP协议交换信息的过程**

BGP所交换的网络可达性信息就是要达到某个网络所要经过的一系列AS,当BGP发言人互相交换了网络可达性的信息后,各BGP发言人就根据所采用的策略从收到的路由信息中找出各AS的较好路由.



#### IP组播

IP数据报可以通过单播,广播和组播的方式进行传播.

IP组播地址 : 让源设备能够将分组发送给一组设备,属于多播组的设备将被分配一个组播组IP地址(一组公同需求主机的相同标识).

组播的地址是D类地址.一个D类地址可以标识一个组播组,只能用作分组的目的地址,源地址总是为单播地址.

组播数据报也是尽最大努力交付的,它不提供可靠交付,应用于UDP.

组播数据报不会产生ICMP差错报文

并不是所有D类地址都可以作为组播地址的.

组播也分为硬件组播和因特网范围内的组播,硬件组播是在局域网内的组播.



#### 移动IP

* 相关术语

  * 移动节点 : 具有永久IP地址的移动设备
  * 归属代理 : 也称本地代理,一个移动节点用友的就居所称为归属网络,在归属网络中代表移动节点执行移动管理功能的实体叫做归属代理
  * 外部代理 : 在外部网络中包含著移动节点完成移动管理功能的实体称为外部代理
  * 永久地址 : 也称归属地址,主地址.移动站点在归属网络中的原始地址
  * 转交地址 : 也称辅地址,移动站点在外部网络使用的临时地址

* 通信过程

  现有一个本地代理中的主机A,A进入外部网络的时候:

  * 在外部代理等级获得一个转交地址,当离开时会注销
  * 外地代理向本地代理登记转交地址.

  现有一个主机B想给A发送数据报

  * 本地代理截获数据报
  * 本地代理再封装数据报,新的数据报的目的地址是转交地址,通过隧道发送给外部代理
  * 外部代理拆封数据报并发送给A

#### 网络层设备

路由器啦没啥好说的.它是一种具有多个输入端口和多个输出端口的专用计算机,它的任务就是转发分组.它的结构有两个:路由选择结构和分组转发结构.

路由选择结构会根据所选定的路由选择协议构造路由表,同时经常或定期的和相邻路由器交换路由信息而不断更新和维护路由表

分组转发结构会根据转发表对分组进行转发.



## 传输层

传输层是主机才会有的层次,网络设备撑死只有下三层.它是为应用层提供服务的.它的功能:

* 提供进程与进程之间的逻辑通信.不同于网络层提供的是主机与主机之间的通信
* 复用和分用 : 复用指进程能够使用相同的协议进行通信,都能通过传输层把数据扔到网络层.分用是指接受方传输层能够将信息发给正确的进程.
* 对收到的报文进行差错检测 : 这里就是对IP数据报的数据段部分进行检查的,所以网络层才不用处理数据段

**端口**

传输层是通过端口的概念来区分具体的应用进程的,端口号是传输层的SAP,区别于下三层的那些端口,这里的端口只是逻辑上的,端口号只具有本地一样,在网络中不同计算机的相同端口号是没有联系的,端口号长度为16比特,也就是4个字节,它能标识65536个不同的应用程序.

服务端的端口 : 有熟知端口号,是给TCP/IP最重要的一些应用程序,分布在0-1023端口上.还有登记端口号,这个是为没有熟知端口号的应用程序使用的,它的范围是1024-49151.

客户端的端口 : 这种端口仅在客户进程允许时才动态选择,它的范围49152 - 65535

#### UDP协议

无连接的用户数据报协议

UDP只是在IP数据报的服务上增加了很少的功能,也就是分用复用和数据段差错检测.

它的主要特点 :

* 无连接的,减少开销和发送数据前的时延
* UDP会尽最大努力交付,是不保证可靠传输的
* UDP是面向报文的(就是对于应用层传下来的报文不做任何处理,只会标记首尾.),适合一次性传输少量数据的网络应用.因为不会对应用层的报文大小不做任何操作,所以应该对于应用层的报文长度最好不能很长,不然会导致网络层的报文分组分片.
* UDP没有拥塞控制,适合很多实时应用
* UDP首部开销很小,才8字节,TCP有20字节.

它的首部格式:前4字节:16为的源端口号,16位的目的端口号,后4字节:16位的UDP长度,16位的UDP检验和.

分用的时候,找不到目的端口号就会丢弃报文,并给发送方发送ICMP端口不可达的差错报文.

**UDP校验**

在发送端:

* 填上伪首部
* 全0填充检验和字段
* 全0填充数据部分(UDP数据报要堪称许多4字节的字串接起来)
* 伪首部+首部+数据部分采用二进制反码求和
* 把和求反码填入检验和字段
* 去掉伪首部,把东西给网络层....直到发送出去

在接收端

* 填上伪首部
* 伪首部+首部+数据部分采用二进制反码求和
* 如果结果全为1就是数据报无差错,否则就丢弃数据报/交给应用层附上出错警告



#### TCP协议

面向连接(虚连接)的传输控制协议.

特点:

* 每一条TCP连接只有两个端点,也就是只能是点对点的
* TCP提供可靠交付服务,无差错,不丢失,不重复,按序到达
* TCP提供全双工通信,带有发送缓存(准备发送的数据和已经发送还没收到确认的数据)和接受缓存(到达了的数据但还没有被应用程序接收的数据,不按序到达的数据)
* TCP是面向字节流的,它把引用程序交下来的数据看作是一连串的无结构的字节流.

**TCP报文段首部**

20字节长度的固定首部.包括:
2字节的源端口,2字节的目的端口,

4字节的序号:在TCP连接中传送的字节流中的每一个字节都按顺序编号,本字段表示报文端所发送数据的第一个字节的序号

4字节的确认号:期望收到对方的下一个报文端的第一个数据字节的序号.若确认号为N,则证明序号N-1位置的所有数据都已经正确收到

0.5字节的数据偏移:就是首部长度,TCP报文端的数据起始处距离TCP报文端的起始处有多远,以4字节为单位.

还有1.5字节的保留和一堆东西.那堆东西是6个控制位:

* 紧急位URG:当URG为1时,标明此报文段中有紧急数据,是高优先级的数据,需要尽快传送,配合紧急指针使用
* 确认号ACK:ACK为1时确认号有效.在建立连接后所有传送的报文段都需要把ACK位置为1.
* 推送位PSH:当它为1的时候,接收方应该尽快交付该报文端给应用进程,不需要等到TCP缓存满再向上交付
* 复位RST:当它为1的时候,表明TCP链接中出现严重错误,必须释放连接然后重新建立连接
* 同步位SYN:当它为1的时候,表明是一个连接请求/连接接收报文
* 终止位FIN:当它为1的时候,表明此报文段发送方数据已经发送完毕,要求释放连接.

2字节的紧急指针:指出本报文段中紧急数据的字节数.

2字节的窗口:指发送本报文段的一方的接收窗口,即现在允许对方发送的数据量.

2字节的检验和:检验首部和数据,检验的时候要加上12字节的伪首部,第四个字段为6

还有选项和填充字段,这俩是可变的.



##### TCP连接管理

TCP连接的建立采用客户端服务器模式,主动发起连接建立的应用进程叫做客户,而被动等待连接建立的应用进程叫服务器.

典中典之建立连接的三次握手过程:

* 客户端发送连接请求报文段,无应用层数据.此时同步位SYN置为1,序号位seq随意的x
* 服务器端为该TCP连接分配缓存和变量,并向客户端返回确认报文端,允许连接,无应用层数据.此时确认位ACK置为1,同步位SYN置为1,序号位为随机的y,确认号字段ack为上次的seq字段+1.也就是x+1
* 客户端为该TCP连接分配缓存和变量,并向服务器端返回确认的确认,可以携带数据,此时确认为置为1,同步位SYN置为0,序号位为x+1,确认号字段为y+1

在握手过程中,存在一个SYN洪泛攻击现象.它是指攻击者发送TCP SYN,SYN因为是TCP连接握手中的第一个数据包,当服务器返回ACK后,攻击者不对其进行确认,那么这个TCP连接就会处于挂起状态,服务器收不到再确认的话,就会重复发送ACK给攻击者.导致服务器资源的浪费,攻击者只要对服务器一直搞这种连接,就会导致大量的TCP连接挂起,此时在服务器上,因为大量TCP连接的挂起,CPU和内存会消耗的非常严重,甚至会引起服务器的死机.对于这种问题,可以通过设置SYNCookie来进行防止

典中典之连接释放的四次挥手过程:

* 客户端主动发起连接释放报文段,停止发送数据,主动关闭TCP连接.此时终止位FIN置为1,序号位seq = u
* 服务器回送一个确认报文端,客户端到服务器这个方向的连接就算是释放了.此时确认位ACK为1,序号位seq取决于上次服务器发送到哪了,确认段ack为上次报文段+1,也就是ack = u+1
* 服务器端发完数据,就发出连接释放报文端,主动关闭TCP连接,此时终止位FIN = 1,确认位ACK = 1,序号段seq = w.确认段ack还是上次的u+1
* 客户端回送一个确认报文段,在等到时间等待计时器设置的2MSL(最长报文段寿命)后,连接彻底关闭.此时确认位ACK=1,序号段还是seq = u+1,确认位为ack = w+1.这里为啥要等一个2MSL嘞,因为要保证确认收到了服务器的连接释放报文段,否则会导致服务器以为客户端没收到会一直发.

#####  TCP可靠传输

因为网路层是尽最大努力交付的,也就是不可靠传输的.所以要实现可靠传输,就得在传输层进行保证.

实现可靠传输的机制

* 校验 : 类似于UDP中检验的机制
* 序号 :  我们知道,TCP是面向字节流的,流的字节单元会被编号.一个字节一个序号.
* 确认 : 在TCP报文发送后,发送方的发送缓存中还是存在这个报文的,只有接收方发送的确认报文被发送方收到了,才会把这个报文扔掉.TCP默认使用的是累计确认机制.
* 重传 : 当TCP的发送方在规定时间内没有收到确认,就需要重新发送已经发送的报文段,也就是一个超时重传机制.这个重传时间是很有讲究的.TCP默认采用自适应算法,能够动态的改变重传时间(RTTs,加权平均往返时间).



##### TCP流量控制

就是控制发送方的发送速率,让接收方能够来得及接收.防止接收方发生严重的丢包.TCP这里也是用滑动窗口的机制来实现流量控制的.在通信过程中,接收方根据自己接收缓存的大小,动态地调整发送方的窗口大小,即接收窗口rwnd(接收方设置确认报文段的窗口字段来将rwnd通知给发送方),发送方的发送窗口取接收窗口rwnd和拥塞窗口cwnd的最小值.

具体步骤:

* TCP为每一个连接设有一个持续的计时器,只要TCP连接的一方接收到对方的零窗口通知,就启动持续计时器.
* 若持续计时器设置的时间到期,就发送一个零窗口探测报文段.接收方收到探测报文端时给出现在的窗口值.
* 如果窗口值仍然是0,那么发送方就重新设置持续计时器.让发送方再发送一次

##### TCP拥塞控制

TCP连接上出现拥塞的条件:对资源需求的总和>可用资源.也就是网络中有许多资源同时出现了供应不足的情况导致网络性能变坏,此时网络吞吐量将随输入负荷增大而下降.

拥塞控制就是用来防止过多的数据注入到网络中的.这是一个全局性的问题.因为网络的拥塞的原因就是因为很多的主机在使用这个网络.

拥塞控制与流量控制的区别 : 流量控制是对于点对点之间的发送方的控制,而拥塞控制是一个全局性的,也就是一个网络内的问题.

拥塞控制的算法:

* 慢开始和拥塞避免
* 快重传和快恢复

## 应用层

应用层是计算机网络体系结构的最上层,它是对应用程序的通信提供服务的.应用层的协议需要定义应用进程交换的报文类型,是请求还是响应?还要定义报文类型的语法.字段的语义,进程何时,如何发送报文,以及对报文进行响应的规则.总结来讲,应用层的功能有:

* 文件传输,访问和管理
* 电子邮件
* 虚拟终端
* 查询服务和远程作业登录

应用层的重要协议:

* FTP
* SMTP,POP3
* HTTP
* DNS

网络应用模型:即C/S客户端服务器模式以及P2P对等模式.

C/S模式 : 网络上的节点分为两类:服务器和客户端.服务器是提供计算服务的设备.它能够永久的提供服务;它具有永久性访问的地址/域名.客户端就算请求计算服务的主机,它能与服务器通信;是间歇性接入网络的;它可能使用的是动态IP地址;它不会与其他客户端直接进行通信.

这类模型的应用非常广泛,比如Web,文件传输FTP,远程登陆,电子邮件等.

P2P模式: 不存在永远在线的服务器,每个主机既可以提供服务,也可以请求服务.任意端系统/节点之间是可以直接通讯的.每一个主机是可以间歇性接入网络的.节点的IP地址是可变的.这种模式的可扩展性(网络中突然加入大量的主机的问题)很好.网络健壮性强(一台主机出问题对网络是没有影响的).

这类模型的应用范围:分布式科学计算,文件共享,流媒体直播/点播,IP层语音通信等.

#### DNS域名解析系统

我们在访问网站的时候,其实就算在进行网络通信.进行网络通信的时候,肯定要知道IP地址,但我们其实是不需要输入IP地址去访问网站的,毕竟IP那么长那么难记,于是就有了域名系统.每个域名都会映射一个IP地址.而这个域名到IP地址的转换就是由DNS域名解析系统来做的.

域名 : 它是由英文字母,数字和.以及-构成的,被.所分开的部分叫做标号.每个标号最大不能超过63个标号.标号的优先级由左到右逐渐变高的.最右边那个是顶级域名,还有一个根,它是在最后一个.标号后的标号.

域名服务器 : 也就是DNS服务器.它是最为重要的一个结构,它分为根域名服务器(当本地域名服务器没有发起请求的的那个域名对应的IP地址的时候,它就会先根域名服务器进行请求,根域名服务器是最顶级的域名服务器,它知道所有顶级域名服务器的地址.然后根据请求的域名去找顶级域名服务器和权限域名服务器,直到得到对应的IP地址),顶级域名服务器(它负责管理该顶级域名服务器注册的所有二级域名),权限域名服务器(它就是负责一共区的域名服务器).还有一个是本地域名服务器,本地域名服务器是离主机最近的.当一个主机发起DNS查询请求时,这个请求报文是最先发给本地域名服务器的.在互联网上一共有13台根域名服务器.它们的名字是A~M.ROOTSERVER.NET.一个这样的根域名服务器可能不止对应一台主机,可能是很多台主机构成的.

域名解析过程:

* 递归查询

  靠别人的方式,也就是开始找域名的IP的时候就是去找DNS域名服务器的帮助.

* 迭代查询

  靠自己的方式,就是本地域名服务器里面没有就去找根域名服务器的,如果根域名服务器找不到就让本地域名服务器去顶级域名服务器,顶级域名服务器找不到就去找权限郁闷服务器.全部都是本地来找的.

#### 文件传输协议FTP

传输文件的协议常用的有两种:

* 文件传送协议FTP : 它能提供不同种类主机系统(硬件软件体系都能不同)之间的文件传输能力,它主要是靠拷贝实现的.

  * FTP是基于C/S模式的协议.用户通过一共客户端程序连接至在远程计算机上允许的服务器程序.依照FTP协议提供服务,进行文件传送的计算机就算FTP服务器,连接FTP服务器,遵循FTP协议与服务器传送文件的电脑就算FTP客户端.我们的Windows操作系统是自带FTP命令的.

  * FTP工作原理:

    * 登录 : 通过FTP地址,以及用户名和密码进行登录FTP服务器,也可也进行匿名登录.

      FTP协议是使用TCP协议实现可靠传输的

    * FTP服务器进程有两个部分 : 主进程和从属进程,主进程只有1个,从属进程可以有很多个.有两个从属的进程是比较重要的:控制进程和数据传输进程.控制进程是传送请求的.数据传输进程才是真正传输文件的进程.

    * FTP传输模式有两种 : 文本模式和二进制模式,文本模式就是以ASCII码的形式,以文本序列传输数据.二进制是以二进制序列进行数据的传输.

* 简单文件传输协议TFTP : 它是一种简单的,轻量级的,面向小文件的文件传输协议



#### 电子邮件协议

电子邮件系统 : 是对实时通信问题的一个改善.

电子邮件包含两个内容 : 信封和内容.信封就是我们邮件的地址.内容的话又包含首部和主体.首部是包含目的地址和主题的.主题就是邮件的具体内容.

电子邮件系统的组成结构 : 用户代理,邮件服务器,协议.

* 用户代理 : 用户和邮件服务器的接口,比如Outlook.Foxmail等.它就是提供给用户撰写,显示,处理信件以及进行通信.
* 邮件服务器 : 它是服务器,需要有超大容量以及不间断提供服务.它提供邮件的发送和接收.以及向发件人邮件传送结果.
* 协议 : 包括发送协议(SMTP)和接收协议(IMAP,POP3).

#### 万维网和超文本传输协议HTTP

万维网是一个大规模的,联机式的信息储藏所.是无数个网络站点和网页的集合.我们需要通过统一资源定位符URL来唯一标识其中的资源.它的一般形式: 协议://主机IP:端口/路径.协议一般就是HTTP/HTTPS或者FTP.用户通过点击超链接获取资源,这些资源通过超文本传输协议,也就是HTTP协议传送给使用者.万维网是以CS模式工作的,用户使用的是浏览器就算万维网客户长须,万维网文档驻留的主机运行服务器程序.

万维网使用超文本标记语言HTML,使万维网页面设计者可以方便的从一个界面的连接转到另一个界面,并能够在自己的屏幕上显示出来.



##### HTTP协议 

它定义了浏览器(也就是万维网客户端)怎样向万维网服务器请求万维网文档,以及服务器如何把文档传输给浏览器.它的过程:

* 万维网的服务器会持续监听TCP的80端口,用以监听是否有客户端请求.
* 当通过浏览器点击超链接或者输入URL时,浏览器会与客户端进行TCP连接,然后发送HTTP请求报文给对应服务器,服务器收到后会发送HTTP响应报文给浏览器
  * 点击超链接或者输入URL后的具体流程:
    * 浏览器分析URL
    * 浏览器向DNS请求解析IP地址
    * DNS解析出IP地址并返回给浏览器
    * 浏览器通过该IP地址与服务器进行TCP连接
    * 浏览器发出文档请求,服务器响应请求
    * 释放TCP连接
    * 浏览器渲染显示文档
* 随后TCP连接释放.

HTTP协议是无状态的(也就是没有记忆的,你不管几次去访问这个网站,它显示都是这样,比如都需要登录),但是实际中,很多站点需要记住用户身份.为了达成这个需求,就产生了会话技术.也就是Session和Cookie.

HTTP采用TCP作为运输层协议,但它本身是无连接的.通信双方在交换HTTP报文之前不需要建立HTTP的连接.

HTTP的连接方式 : 持久连接和非持久连接.

* 非持久连接 : 在非持久连接中,建立TCP连接的第三次握手的时候,客户端就可以发送HTTP报文给服务器了,然后服务器会返回给HTTP响应报文.这个过程就只能响应一个报文.然后TCP连接就断开了.如果需要再次请求其他资源,就必须重新建立TCP连接,会很消耗时间.
* 持久连接 : 经过TCP连接握手后,在一段时间内保持连接,可以持续进行请求和响应.



##### HTTP协议报文结构

HTTP报文分为请求报文和响应报文.它是面向文本的,因此在报文中的每一个字段都是一些ASCII码串.

* 请求报文结构:

  [方法(对资源的操作,比如get,post等)+空格+URL+空格+版本(HTTP协议版本)+回车换行]一段为请求行.中间是一些首部行.首部行是说明浏览器,服务器和报文主体的信息的东西.后面是通常用不到的实体.

* 响应报文结构:

  [版本+空格+状态码+短语+回车换行]一段为状态行.中间是一些首部行,后面是实体,有些响应报文也不用这个实体

  状态码 : 

  * 1xx : 表示通知信息,比如服务器正在处理请求
  * 2xx : 表示请求成功,比如已接受
  * 3xx : 表示请求重定向
  * 4xx : 表示客户端差错,比如请求中有错误,无法完成请求
  * 5xx : 表示服务器差错



























































